<!DOCTYPE html>
<!-- saved from url=(0036)http://www.352328759a.site/lin/l.php -->
<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
		<title>词库</title>
		<link rel="stylesheet" href="../jvw/element-ui/element-ui@2.4.0/element-ui.2.4.0.css">
		<style>
			* {
				/*-moz-user-select: none;
			-ms-user-select: none;
			-webkit-user-select: none;
			user-select: none;*/
			}
			
			#timeLists {
				width: 100%;
			}
			
			#timeLists td {
				padding: 5px;
				text-align: center;
			}
			
			#timeLists .timeList:hover {
				outline: 1px solid #0f0;
			}
			
			#timeLists .timeList.act {
				outline: 1px solid #f00;
			}
			
			.editTheWord {
				border: #000000 1px solid;
				padding: 10px;
			}
			
			.editWord__fileList {
				display: flex;
			}
			
			.lexicon img {
				display: inline-block;
			}
			
			.lexiconSearch {
				background: #ffffaa;
			}
			
			.flip-list-move {
				transition: transform 0.4s;
			}
		</style>
	</head>

	<body>

		<div id="swq">
			<swq></swq>
		</div>

		<script type="text/x-template" id="swq-template">
			<div>
				<editTheWord @addword="addword" :editWord="editWord" :editHex="editHex" :editInd="editInd"></editTheWord>

				<el-upload action="" :file-list="fileList" :show-file-list="false" :auto-upload="false" :on-change="handleChange" multiple drag>
					<div class="el-upload__text">将文件拖到此处，或<em>点击上传</em></div>
				</el-upload>

				<transition-group name="flip-list">
					<div v-for="(item, index) in fileList" class="editWord__fileList" :key="item.uid">
						<el-button-group>
							<el-button type="primary" @click="moveUp(index)">上移</el-button>
							<el-button type="primary" @click="moveDown(index)">下移</el-button>
							<el-button type="primary" @click="addOne(index)">加一</el-button>
							<el-button type="primary" @click="removeOne(index)">删除</el-button>
						</el-button-group>
						<div><img :src="item.url" :alt="item.name" :title="item.name" /></div>
						<div>{{item.name}}</div>
					</div>
				</transition-group>

				<input type="text" name="" v-model="editWord" />
				<el-button size="mini" type="primary" @click="checkRepeat">查重</el-button>
				<el-button size="mini" type="primary" @click="checkOut">导出</el-button>
				<el-button size="mini" type="primary" @click="upDate">更新</el-button>
				<el-button size="mini" type="primary" @click="sortFoWord">排序</el-button>
				<table id="timeLists">
					<tr class="timeList">
						<th>emoji</th>
						<th>答案</th>
					</tr>
					<tr class="timeList lexicon lexiconSearch" v-for="(item, index) in lexiconSearch">
						<td>
							{{lexicon.length - index}}
							<img v-for="(_item, _index) in item.hex" :src="'messyCode/' + v_Escape(_item) + '.png'" :alt="_item" :title="_item" />
						</td>
						<td>
							<input type="text" name="" :value="item.word" readonly="readonly" />
							<button class="" type="button" @click="copy($event)">复制</button>
						</td>
					</tr>
					<tr class="timeList lexicon" v-for="(item, index) in lexicon">
						<td>
							{{lexicon.length - index}}
							<img v-for="(_item, _index) in item.hex" :src="'messyCode/' + v_Escape(_item) + '.png'" :alt="_item" :title="_item" />
						</td>
						<td>
							<input type="text" name="" :value="item.word" readonly="readonly" />
							<button class="" type="button" @click="copy($event)">复制</button>
							<button class="" type="button" @click="editThis(item, index)">编辑</button>
						</td>
					</tr>
				</table>
			</div>
		</script>
		<script type="text/x-template" id="editTheWord-template">
			<div class="editTheWord">
				<el-upload action="" :file-list="fileList" :show-file-list="false" :auto-upload="false" :on-change="handleChange" multiple drag>
					<div class="el-upload__text">将文件拖到此处，或<em>点击上传</em></div>
				</el-upload>

				<transition-group name="flip-list">
					<div v-for="(item, index) in fileList" class="editWord__fileList" :key="item.uid">
						<el-button-group>
							<el-button type="primary" @click="moveUp(index)">上移</el-button>
							<el-button type="primary" @click="moveDown(index)">下移</el-button>
							<el-button type="primary" @click="addOne(index)">加一</el-button>
							<el-button type="primary" @click="removeOne(index)">删除</el-button>
						</el-button-group>
						<div><img :src="item.url" :alt="item.name" :title="item.name" /></div>
						<div>{{item.name}}</div>
					</div>
				</transition-group>

				<input type="text" name="" :value="word" @input="word = $event.target.value" />

				<el-button size="mini" type="success" @click="addword">确定</el-button>
			</div>
		</script>

		<script src="../jvw/vue/vue.2.5.16.js"></script>
		<script src="../jvw/element-ui/element-ui@2.4.0/1element-ui.2.4.0.js"></script>
		<script src="./js/lexicon.js"></script>

		<script type="text/javascript">
			var editTheWord = {
				template: "#editTheWord-template",
				//				props: ["editWord", "editHex", "editInd"],
				props: {
					editWord: String,
					editHex: Array,
					editInd: {
						type: Number,
						default: null
					},
				},
				data: function() {
					return {
						fileList: [],
						word: "",
					}
				},
				computed: {},
				components: {},
				watch: {
					editWord: function(val) {
						this.word = this.editWord
					},
					editInd: function(val) {
						this.fileList = this.editHex.map(function(item, index) {
							return {
								name: item + '.png',
								uid: index,
								url: 'messyCode/' + escape(item) + '.png',
							}
						})
					},
				},
				methods: {
					moveUp: function(index) {
						// 上移
						let list = this.fileList;
						if(index > 0) {
							let lin = list.splice(index, 1)
							list.splice(index - 1, 0, lin[0])
							this.fileList = list
						} else {
							this.$message({
								message: "已是首项",
								type: "warning"
							});
						}
					},
					moveDown: function(index) {
						// 下移
						let list = this.fileList;
						if(index < list.length - 1) {
							let lin = list.splice(index, 1)
							list.splice(index + 1, 0, lin[0])
							this.fileList = list
						} else {
							this.$message({
								message: "已是末项",
								type: "warning"
							});
						}
					},
					addOne: function(index) {
						// 加一
						let list = this.fileList;
						let lin = JSON.parse(JSON.stringify(list[index]))
						lin.uid = new Date() * 1
						list.splice(index, 0, lin)
					},
					removeOne: function(index) {
						// 删除
						let list = this.fileList;
						list.splice(index, 1)
					},
					addword: function() {
						// 增加一个成语
						let hex = this.fileList.map(function(item) {
							return item.name.split(".")[0]
						})
						console.log(hex)
						if(this.word == "" || hex.length < 4) {
							this.$message({
								message: "数据缺失",
								type: "warning"
							});
							return false;
						} else {
							this.$emit("addword", {
								index: this.editInd,
								hex: hex,
								word: this.word
							})
							this.fileList = []
							this.word = ""
						}
					},
					handleChange: function(file, fileList) {
						// file.url
						// console.log(file, fileList)
						// file.tid = "t" + fileList.length + "_" + ~~(Math.random() * 100)
						this.fileList.push(file)
						// this.fileList = fileList;
					},
				},
				created() {},
				mounted() {},
			}
			var swq = {
				template: "#swq-template",
				props: [],
				data() {
					return {
						lexicon: [],
						fileList: [],
						//						isSort: false,
						editWord: "",
						editHex: [],
						editInd: null,
					};
				},
				computed: {
					//					lexiconSort: function() {
					//						// 排序后的数组
					//						if(this.isSort) {
					//							return this.sortFoWord(this.lexicon)
					//						} else {
					//							return this.lexicon
					//						}
					//					},
					lexiconSearch: function() {
						if(this.editWord == "" && this.fileList.length == 0) {
							return []
						}
						let _this = this
						let editWord = this.editWord.replace(/ +/g, ".*")
						let rgExp = new RegExp(editWord)
						return this.lexicon.filter(function(item) {
							if(_this.fileList.length > 0) {
								for(let i = 0; i < _this.fileList.length; i++) {
									if(item.hex[i] == _this.fileList[i].name.split(".")[0]) {} else {
										return false;
									}
								}
								return true;
							}

							if(_this.editWord !== "" && !!(item.word.search(rgExp) >= 0)) {
								return true;
							}
						})

						//						this.fileList
					},
				},
				components: {
					editTheWord,
				},
				watch: {},
				methods: {
					moveUp: function(index) {
						// 上移
						let list = this.fileList;
						if(index > 0) {
							let lin = list.splice(index, 1)
							list.splice(index - 1, 0, lin[0])
							this.fileList = list
						} else {
							this.$message({
								message: "已是首项",
								type: "warning"
							});
						}
					},
					moveDown: function(index) {
						// 下移
						let list = this.fileList;
						if(index < list.length - 1) {
							let lin = list.splice(index, 1)
							list.splice(index + 1, 0, lin[0])
							this.fileList = list
						} else {
							this.$message({
								message: "已是末项",
								type: "warning"
							});
						}
					},
					addOne: function(index) {
						// 加一
						let list = this.fileList;
						let lin = JSON.parse(JSON.stringify(list[index]))
						lin.uid = new Date() * 1
						list.splice(index, 0, lin)
					},
					removeOne: function(index) {
						// 删除
						let list = this.fileList;
						list.splice(index, 1)
					},
					handleChange: function(file, fileList) {
						// file.url
						// console.log(file, fileList)
						// file.tid = "t" + fileList.length + "_" + ~~(Math.random() * 100)
						this.fileList.push(file)
						// this.fileList = fileList;
					},
					addword: function(item) {
						// 增加一个成语
						console.log(item)

						if(item.index != null) {
							this.lexicon[item.index].word = item.word
							this.lexicon[item.index].hex = item.hex
						} else {
							this.lexicon.unshift({
								word: item.word,
								hex: item.hex
							})
						}
						this.setItemLexicon()
					},
					v_Escape: function(_r) {
						// 过滤图片地址特殊符号
						return escape(_r)
					},
					setItemLexicon: function() {
						sessionStorage.setItem("lexicon", JSON.stringify(this.lexicon));
					},
					sortFoWord: function(_l) {
						// 按 word 排序
						//						let flexicon = JSON.parse(JSON.stringify(_l))
						this.lexicon.sort(function(a, b) {
							let _i = (a.word).localeCompare(b.word)
							if(_i == 0) {
								return(a.hex.join("")).localeCompare(b.hex.join(""))
							} else {
								return _i
							}
						})
						this.setItemLexicon()
						//						return flexicon
					},
					checkRepeat: function() {
						// 查重
						this.sortFoWord()
						let flexicon = this.lexicon

						for(var i = 0; i < flexicon.length - 1; i++) {
							if(flexicon[i].word == flexicon[i + 1].word) {
								if(
									(flexicon[i].hex[0] == flexicon[i + 1].hex[0]) &&
									(flexicon[i].hex[1] == flexicon[i + 1].hex[1]) &&
									(flexicon[i].hex[2] == flexicon[i + 1].hex[2]) &&
									(flexicon[i].hex[3] == flexicon[i + 1].hex[3])
								) {
									console.warn("重复项:", flexicon[i])
								}
							}
						}
						console.log("查重完毕")

					},
					checkOut: function() {
						// 导出
						console.log(JSON.stringify(this.lexicon))
					},
					upDate: function() {
						// 更新
						sessionStorage.setItem("lexicon", JSON.stringify(lexicon));
						this.lexicon = JSON.parse(sessionStorage.getItem("lexicon"))
					},
					copy: function($event) {
						// 复制成语
						let element = $event.currentTarget
						let pre;

						if(element.previousElementSibling) {
							pre = element.previousElementSibling;
						} else {
							var prev = element.previousSibling; //上一个兄弟节点
							while(prev && 1 !== prev.nodeType) { //有 并且 不是我想要的
								prev = prev.previousSibling;
							}
							pre = prev;
						}

						pre.select();
						document.execCommand("Copy");
					},
					editThis: function(item, index) {
						// 编辑
						this.editWord = item.word
						this.editHex = item.hex
						this.editInd = index
					},
				},
				created() {

					if(sessionStorage.getItem("lexicon") == null) {
						this.lexicon = lexicon
					} else {
						this.lexicon = JSON.parse(sessionStorage.getItem("lexicon"))
					}

				},
				mounted() {},
			};
			var vu = new Vue({
				el: "#swq",
				data: {},
				methods: {},
				components: {
					swq: swq,
				},
				watch: {},
				computed: {},
				created() {},
				mounted() {},
			})
		</script>

	</body>

</html>