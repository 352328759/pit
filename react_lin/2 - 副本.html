<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>7-3 高阶组件(HOC)</title>
	<!-- P172 -->
</head>

<body>
	<div id="react-container"></div>
	<!-- <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
	<script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
	<script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script> -->
	<script src="https://cdn.bootcdn.net/ajax/libs/react/16.13.1/umd/react.development.js"></script>
	<script src="https://cdn.bootcdn.net/ajax/libs/react-dom/16.13.1/umd/react-dom.development.js"></script>
	<script src="https://cdn.bootcdn.net/ajax/libs/babel-standalone/7.0.0-beta.3/babel.min.js"></script>

	<script type="text/babel">

		const { Component } = React
		const { render } = ReactDOM

		const DataComponent = (ComposedComponent, url) =>
			class DataComponent extends Component {

				constructor(props) {
					super(props)
					console.log(props)
					this.state = {
						data: [],
						loading: false,
						loaded: false
					}
				}

				componentWillMount() {
					this.setState({ loading: true })
					fetch(url)
						.then(response => response.json())
						.then(data => this.setState({
							loaded: true,
							loading: false,
							data
						}))
				}

				render() {
					return (
						<div className="data-component">
							{(this.state.loading) ?
								<div>Loading...</div> :
								<ComposedComponent {...this.state} {...this.props} />
							}
						</div>
					)
				}
			}

		class PeopleList extends Component {
			render() {
				const { data } = this.props
				return (
					<ol className="people-list">
						{data.results.map((person, i) => {
							const { first, last } = person.name
							return <li key={i}>{first} {last}</li>
						})}
					</ol>
				)
			}
		}

		// const PeopleList = (props) =>
		// 	<ol className="people-list">
		// 		{console.log(props)}
		// 		{props.data.results.map((person, i) => {
		// 			const { first, last } = person.name
		// 			return <li key={i}>{first} {last}</li>
		// 		})}
		// 	</ol>

		// const PeopleList = ({ data }) =>
		// 	<ol className="people-list">
		// 		{data.results.map((person, i) => {
		// 			const { first, last } = person.name
		// 			return <li key={i}>{first} {last}</li>
		// 		})}
		// 	</ol>

		const RandomMeUsers = DataComponent(
			PeopleList,
			"https://randomuser.me/api?results=10"
		)

		const CountryNames = ({ data, selected = "" }) =>
			<select className="people-list" defaultValue={selected}>
				{data.map(({ name }, i) =>
					<option key={i} value={name}>{name}</option>
				)}
			</select>

		const CountryDropDown = DataComponent(
			CountryNames,
			"https://restcountries.eu/rest/v1/all"
		)

		render(
			<div>
				<RandomMeUsers count={20} />
				<CountryDropDown selected="United States" />
			</div>,
			document.getElementById('react-container')
		)

	</script>
</body>

</html>