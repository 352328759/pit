<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>7-3 高阶组件(HOC)</title>
	<!-- P172 -->
</head>

<body>
	<div id="react-container"></div>
	<!-- <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
	<script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
	<script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script> -->
	<script src="https://cdn.bootcdn.net/ajax/libs/react/16.13.1/umd/react.development.js"></script>
	<script src="https://cdn.bootcdn.net/ajax/libs/react-dom/16.13.1/umd/react-dom.development.js"></script>
	<script src="https://cdn.bootcdn.net/ajax/libs/babel-standalone/7.0.0-beta.3/babel.min.js"></script>

	<script type="text/babel">

		const { Component } = React
		const { render } = ReactDOM

		const HOC = (ComposedComponent, url) =>
			class HOC extends Component {

				constructor(props) {
					super(props)
					console.log(props)
					this.state = {
						data: [],
						loading: false,
						loaded: false
					}
				}

				componentWillMount() {
					this.setState({ loading: true })
					fetch(url)
						.then(response => response.json())
						.then(data => this.setState({
							loaded: true,
							loading: false,
							data
						}))
				}

				render() {
					return (
						<div className="data-component">
							{(this.state.loading) ?
								<div>Loading...</div> :
								<ComposedComponent {...this.state} {...this.props} />
								// state 和 props 都作为 props 传入子组件
							}
						</div>
					)
				}
			}

		// class Component1 extends Component {
		// 	render() {
		// 		const { data } = this.props
		// 		return (
		// 			<ol className="people-list">
		// 				{data.results.map((person, i) => {
		// 					const { first, last } = person.name
		// 					return <li key={i}>{first} {last}</li>
		// 				})}
		// 			</ol>
		// 		)
		// 	}
		// }

		// const Component1 = (props) =>
		// 	<ol className="people-list">
		// 		{console.log(props)}
		// 		{props.data.results.map((person, i) => {
		// 			const { first, last } = person.name
		// 			return <li key={i}>{first} {last}</li>
		// 		})}
		// 	</ol>

		const Component1 = ({ data }) =>
			<ol className="people-list">
				{data.results.map((person, i) => {
					const { first, last } = person.name
					return <li key={i}>{first} {last}</li>
				})}
			</ol>

		const Com1 = HOC(Component1, "https://randomuser.me/api?results=10")

		const Component2 = ({ data, selected = "" }) =>
			<select className="people-list" defaultValue={selected}>
				{data.map(({ name }, i) =>
					<option key={i} value={name}>{name}</option>
				)}
			</select>

		const Com2 = HOC(Component2, "https://restcountries.eu/rest/v1/all")

		render(
			<div>
				<ul>
					<li>高阶组件是一个函数, 它接收一个组件, 包装成另一个组件并返回</li>
					<li>高阶组件是一种编程技巧, 不是react的语法</li>
				</ul>

				<h1>基本用法</h1>
				<Com1 />

				<h1>HOC 不处理,直接将 props 往下传递</h1>
				<Com2 selected="United States" />
			</div>,
			document.getElementById('react-container')
		)

	</script>
</body>

</html>